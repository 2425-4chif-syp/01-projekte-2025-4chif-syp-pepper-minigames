<div class="min-h-screen bg-slate-50 p-6">
    <div class="max-w-6xl mx-auto">
        <!-- Page Header -->
        <div class="mb-6">
            <h1 class="text-2xl font-bold text-slate-800">Bewohner verwalten</h1>
            <p class="text-slate-500 mt-1">Verwalten Sie die Bewohnerliste</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- LEFT: User List -->
            <p-card styleClass="shadow-md">
                <ng-template pTemplate="header">
                    <div class="px-4 pt-4 flex items-center justify-between">
                        <h2 class="text-lg font-semibold text-slate-800">Bewohnerliste</h2>
                        <p-tag [value]="filteredUsers().length + ' Bewohner'" severity="info" [rounded]="true"></p-tag>
                    </div>
                </ng-template>

                <!-- Search -->
                <div class="mb-4">
                    <span class="p-input-icon-left w-full">
                        <i class="pi pi-search"></i>
                        <input
                            pInputText
                            type="text"
                            [(ngModel)]="searchTerm"
                            (ngModelChange)="onSearchChange()"
                            placeholder="Bewohner suchen..."
                            class="w-full"
                        />
                    </span>
                </div>

                <!-- List -->
                @if (!searchLoading) {
                    <div class="max-h-96 overflow-y-auto">
                        @if (filteredUsers().length > 0) {
                            <p-table
                                [value]="filteredUsers()"
                                [scrollable]="true"
                                scrollHeight="400px"
                                styleClass="p-datatable-sm"
                            >
                                <ng-template pTemplate="body" let-user>
                                    <tr class="hover:bg-slate-50">
                                        <td class="py-3">
                                            <div class="flex items-center gap-3">
                                                <p-avatar
                                                    [label]="user.firstname.charAt(0) + user.lastname.charAt(0)"
                                                    styleClass="bg-indigo-100 text-indigo-700"
                                                    shape="circle"
                                                ></p-avatar>
                                                <div>
                                                    <div class="font-medium text-slate-800">
                                                        {{ user.firstname }} {{ user.lastname }}
                                                    </div>
                                                    @if (user.dob && user.dob !== '2130-01-01') {
                                                        <div class="text-xs text-slate-500">
                                                            {{ user.dob | date: 'dd.MM.yyyy' }}
                                                        </div>
                                                    }
                                                </div>
                                            </div>
                                        </td>
                                        <td class="py-3 text-right">
                                            <p-button
                                                icon="pi pi-trash"
                                                severity="danger"
                                                [text]="true"
                                                [rounded]="true"
                                                (onClick)="deleteUser(user)"
                                                pTooltip="Löschen"
                                            ></p-button>
                                        </td>
                                    </tr>
                                </ng-template>
                            </p-table>
                        } @else {
                            <div class="text-center py-8 text-slate-500">
                                <i class="pi pi-users text-4xl mb-3 block text-slate-300"></i>
                                <p>Keine Bewohner gefunden</p>
                            </div>
                        }
                    </div>
                } @else {
                    <div class="flex items-center justify-center py-12">
                        <p-progressSpinner
                            [style]="{ width: '40px', height: '40px' }"
                            strokeWidth="4"
                        ></p-progressSpinner>
                    </div>
                }
            </p-card>

            <!-- RIGHT: Add New User -->
            <p-card styleClass="shadow-md">
                <ng-template pTemplate="header">
                    <div class="px-4 pt-4">
                        <h2 class="text-lg font-semibold text-slate-800">Neue Person hinzufügen</h2>
                    </div>
                </ng-template>

                <div class="space-y-4">
                    <!-- Firstname -->
                    <div>
                        <label for="firstName" class="block text-sm font-medium text-slate-600 mb-2">
                            Vorname
                        </label>
                        <input
                            id="firstName"
                            pInputText
                            [(ngModel)]="newUser.firstname"
                            placeholder="Vorname eingeben"
                            class="w-full"
                        />
                    </div>

                    <!-- Lastname -->
                    <div>
                        <label for="lastName" class="block text-sm font-medium text-slate-600 mb-2">
                            Nachname
                        </label>
                        <input
                            id="lastName"
                            pInputText
                            [(ngModel)]="newUser.lastname"
                            placeholder="Nachname eingeben"
                            class="w-full"
                        />
                    </div>

                    <!-- Date of Birth (conditional) -->
                    @if (showDobInput) {
                        <div class="p-4 bg-amber-50 border border-amber-200 rounded-lg">
                            <label for="dob" class="block text-sm font-medium text-amber-800 mb-2">
                                <i class="pi pi-info-circle mr-1"></i>
                                Geburtsdatum
                            </label>
                            <p class="text-xs text-amber-700 mb-2">
                                Es gibt bereits eine Person mit diesem Namen. Bitte Geburtsdatum angeben.
                            </p>
                            <p-datepicker
                                id="dob"
                                [(ngModel)]="newUser.dob"
                                dateFormat="dd.mm.yy"
                                [showIcon]="true"
                                styleClass="w-full"
                            ></p-datepicker>
                        </div>
                    }
                </div>

                <ng-template pTemplate="footer">
                    <div class="flex justify-end">
                        <p-button
                            label="Hinzufügen"
                            icon="pi pi-plus"
                            (onClick)="addUser()"
                            [disabled]="!newUser.firstname || !newUser.lastname"
                        ></p-button>
                    </div>
                </ng-template>
            </p-card>
        </div>
    </div>
</div>
