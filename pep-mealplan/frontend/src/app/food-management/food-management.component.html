<div class="min-h-screen flex justify-center bg-indigo-200">
    <div class="flex flex-col md:flex-row gap-8 w-full p-6">

        <!-- LEFT: Food-Liste -->
        <div class="w-full md:w-1/3 bg-white rounded-2xl shadow-md p-4 flex flex-col">
            @if (foods().length !== 0) {
                <p-list-box
                        [options]="foods()"
                        [(ngModel)]="selectedFood"
                        (ngModelChange)="onFoodSelected($event)"
                        optionLabel="Name"
                        [filter]="true"
                        [listStyle]="{ 'max-height': '80vh', 'overflow': 'auto' }"
                        class="w-full"
                >
                </p-list-box>
            } @else {
                <div class="loading flex flex-col justify-center items-center h-full py-10">
                    <p-progressSpinner
                            [style]="{ width: '40px', height: '40px' }"
                            strokeWidth="6"
                    ></p-progressSpinner>
                    <div class="loading-text mt-4 text-sm text-slate-600">
                        Gerichte werden geladen
                    </div>
                </div>
            }
        </div>


        <!-- RIGHT: Formular -->
        <div class="w-full md:w-2/3 bg-white rounded-2xl shadow-md p-6">
            <div class="gap-6">

                <!-- Bildbereich -->
                <div class="">
                    <div class="w-full h-52 rounded-lg overflow-hidden bg-slate-100">
                        @if (newFood.Picture.Base64) {
                            <img
                                    [src]="img.src"
                                    id="previewImageNewFood"
                                    alt="Gericht Bild"
                                    (click)="fileUpload.click()"
                                    class="w-full h-full object-cover cursor-pointer"
                            />
                        } @else {
                            <img
                                    [src]="apiUrl + '/images/preview-image.png'"
                                    id="previewImageNewFood"
                                    crossorigin="anonymous"
                                    alt="Vorschau Bild"
                                    (click)="fileUpload.click()"
                                    class="w-full h-full object-cover cursor-pointer"
                            />
                        }
                    </div>

                    @if (!newFood.Picture.Base64) {
                        <div class="mt-2 text-sm text-red-500">
                            Bild ist erforderlich
                        </div>
                    }

                    <input
                            type="file"
                            id="picture"
                            (change)="onFileSelected($event)"
                            hidden
                            #fileUpload
                    />
                </div>

                <!-- Text / Formular -->
                <div class="w-full flex flex-col gap-4 mt-5">
                    <div>
                        <h2 class="text-xl font-semibold text-slate-800">
                            {{ newFood.ID ? 'Gericht bearbeiten:' : 'Neues Gericht anlegen:' }}
                        </h2>
                    </div>

                    <!-- Name -->
                    <div class="flex flex-col gap-1">
                        <input
                                id="name"
                                pInputText
                                [(ngModel)]="newFood.Name"
                                name="foodName"
                                placeholder="Name"
                                required
                                class="w-full"
                        />
                        @if (!newFood.Name) {
                            <div class="text-sm text-red-500">
                                Name ist erforderlich
                            </div>
                        }
                    </div>

                    <!-- Typ (PrimeNG Select) -->
                    <div class="flex flex-col gap-1">
                        <label class="text-sm text-slate-600 mb-1">Typ</label>
                        <p-select
                                class="w-full"
                                [options]="foodTypes"
                                optionLabel="label"
                                optionValue="value"
                                [(ngModel)]="newFood.Type"
                                name="foodType"
                                [showClear]="true"
                                placeholder="Bitte auswählen"
                                (onChange)="onFoodTypeChange($event.value)"
                        ></p-select>
                        @if (!newFood.Type) {
                            <div class="text-sm text-red-500">
                                Typ ist erforderlich
                            </div>
                        }
                    </div>
                </div>
            </div>

            <!-- Buttons -->
            <div class="mt-6 flex flex-wrap justify-end gap-3">
                @if (newFood.ID) {
                    <button
                            pButton
                            type="button"
                            label="Löschen"
                            severity="danger"
                            (click)="deleteFood(newFood.ID, newFood.Name)"
                    ></button>

                    <button
                            pButton
                            type="button"
                            label="Abbrechen"
                            severity="secondary"
                            (click)="resetForm()"
                    ></button>
                }
                <button
                        pButton
                        type="button"
                        [label]="newFood.ID ? 'Speichern' : 'Hinzufügen'"
                        severity="primary"
                        (click)="addFood()"
                        [disabled]="!newFood.Name || !newFood.Type || !newFood.Picture.Base64"
                ></button>
            </div>
        </div>
    </div>
</div>
