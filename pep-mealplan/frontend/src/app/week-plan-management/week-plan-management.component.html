@if (!isloading()) {
    <div
            cdkDropListGroup
            class="grid grid-cols-[3fr_1fr] gap-6 p-8"
    >
        <!-- LINKER BEREICH: WOCHENPLAN -->
        <div class=" p-8 rounded-xl">
            <h2 class="mb-6 text-xl font-bold text-gray-800 text-center">
                WOCHENPLAN
            </h2>

            <div class="flex justify-between items-center mb-4 gap-2">
                <p-button
                        (click)="resetDate()"
                        label="Diese Woche"
                >
                </p-button>
                <p-button
                        (click)="exportAsWord()"
                        label="Als Word herunterladen"
                        severity="danger"
                >
                </p-button>
            </div>

            <div
                    class="grid grid-cols-6 gap-4 text-center max-h-[55vh] overflow-y-auto rounded-lg
                    bg-white shadow-md border border-gray-300 relative select-none box-border"
            >
                <!-- Sticky Header -->
                <div
                        class="col-span-6 bg-white font-bold p-4 sticky top-0 z-10"
                >
                    <div
                            class="flex items-center justify-center gap-2 mb-3"
                    >
                        <button
                                (click)="changeDate(-7)"
                        >
                            <i class="pi pi-chevron-left"></i>
                        </button>

                        <input
                                type="date"
                                (change)="dateChange()"
                                [(ngModel)]="selectedDate"
                                class="border border-gray-300 rounded px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-[#00529e]"
                        />

                        <button
                                (click)="changeDate(7)"
                        >
                            <i class="pi pi-chevron-right"></i>
                        </button>
                    </div>

                    <div
                            class="flex justify-between items-center gap-2"
                    >
                        <div
                                class="flex-1 p-2 text-center bg-[#e6f0ff] rounded font-bold text-xs md:text-sm"
                        >
                            SUPPE
                        </div>
                        <div
                                class="flex-1 p-2 text-center bg-[#e6f0ff] rounded font-bold text-xs md:text-sm"
                        >
                            1. MENÜ
                        </div>
                        <div
                                class="flex-1 p-2 text-center bg-[#e6f0ff] rounded font-bold text-xs md:text-sm"
                        >
                            2. MENÜ
                        </div>
                        <div
                                class="flex-1 p-2 text-center bg-[#e6f0ff] rounded font-bold text-xs md:text-sm"
                        >
                            DESSERT
                        </div>
                        <div
                                class="flex-1 p-2 text-center bg-[#e6f0ff] rounded font-bold text-xs md:text-sm"
                        >
                            1. ABEND
                        </div>
                        <div
                                class="flex-1 p-2 text-center bg-[#e6f0ff] rounded font-bold text-xs md:text-sm"
                        >
                            2. ABEND
                        </div>
                    </div>
                </div>

                <!-- Tageszeilen -->
                @for (dayPlan of currentWeekPlan!.dayPlans; track dayPlan; let i = $index) {
                    <!-- Tages-Label -->
                    <div
                            class="col-span-6 font-bold text-xs text-gray-800 bg-[#eef3f9] px-2 py-2 rounded my-1"
                    >
                        {{ WEEK_DAYS[i] }} - {{ dateCleaned(i) }}
                    </div>

                    <!-- SUPPE -->
                    <div
                            class="border border-gray-300 p-2 flex justify-center items-center h-[70px] text-xs
                            md:text-sm font-bold shadow-sm transition-transform duration-200
                            select-none cursor-pointer overflow-hidden bg-[#ffe9cc]"
                    >
                        @if (dayPlan.daySoup) {
                            <div
                                    class="text-xs md:text-sm px-1"
                            >
                                <p>{{ dayPlan.daySoup }}</p>
                            </div>
                        }
                    </div>

                    <!-- MENÜ 1 -->
                    <div
                            class="border border-gray-300 p-2 flex justify-center items-center h-[70px] text-xs md:text-sm font-bold
                            shadow-sm transition-transform duration-200 select-none cursor-pointer overflow-hidden bg-[#d9f7d9]"

                    >
                        @if (dayPlan.menuOne) {
                            <div
                                    class="text-xs md:text-sm px-1"
                            >
                                <p>{{ dayPlan.menuOne }}</p>
                            </div>
                        }
                    </div>

                    <!-- MENÜ 2 -->
                    <div
                            class="border border-gray-300 p-2 flex justify-center items-center h-[70px] text-xs md:text-sm
                            font-bold shadow-sm transition-transform duration-200 select-none cursor-pointer overflow-hidden bg-[#d9f7d9]"
                    >
                        @if (dayPlan.menuTwo) {
                            <div
                                    class="text-xs md:text-sm px-1"
                            >
                                <p>{{ dayPlan.menuTwo }}</p>
                            </div>
                        }
                    </div>

                    <!-- DESSERT -->
                    <div
                            class="border border-gray-300 p-2 flex justify-center items-center h-[70px] text-xs md:text-sm
                            font-bold shadow-sm transition-transform duration-200 select-none cursor-pointer overflow-hidden bg-[#ffdce0]"
                    >
                        @if (dayPlan.dessert) {
                            <div
                                    class="text-xs md:text-sm px-1"
                            >
                                <p>{{ dayPlan.dessert }}</p>
                            </div>
                        }
                    </div>

                    <!-- ABEND 1 -->
                    <div
                            class="border border-gray-300 p-2 flex justify-center items-center h-[70px] text-xs md:text-sm
                             font-bold shadow-sm transition-transform duration-200 select-none cursor-pointer overflow-hidden bg-[#ddeeff]"
                    >
                        @if (dayPlan.eveningOne) {
                            <div
                                    class="text-xs md:text-sm px-1"
                            >
                                <p>{{ dayPlan.eveningOne }}</p>
                            </div>
                        }
                    </div>

                    <!-- ABEND 2 -->
                    <div
                            class="border border-gray-300 p-2 flex justify-center items-center h-[70px] text-xs md:text-sm
                            font-bold shadow-sm transition-transform duration-200 select-none cursor-pointer overflow-hidden bg-[#ddeeff]"
                    >
                        @if (dayPlan.eveningTwo) {
                            <div
                                    class="text-xs md:text-sm px-1"
                            >
                                <p>{{ dayPlan.eveningTwo }}</p>
                            </div>
                        }
                    </div>
                }
            </div>
        </div>

        <!-- RECHTER BEREICH: ESSEN-LISTE -->
        <div
                class="flex flex-col p-8 rounded-xl shadow-lg"
        >
            <h2 class="mb-4 text-xl font-bold text-gray-800">
                Personen
            </h2>

            <h4>Name suchen:</h4>

            <div class="card flex justify-center mt-3">
                <p-multiSelect [options]="personList" [(ngModel)]="selectedResident"
                               placeholder="Name suche ..." optionLabel="name" display="chip" class="w-full md:w-80" />
            </div>
        </div>
    </div>
} @else {
    <div class="flex flex-col justify-center items-center h-screen gap-4">
        <div class="card flex justify-center">
                <p-progressSpinner strokeWidth="8" fill="transparent" animationDuration=".5s" [style]="{ width: '50px', height: '50px' }" />
            <p>WOCHENPLAN Loading ...</p>
        </div>
    </div>
}
