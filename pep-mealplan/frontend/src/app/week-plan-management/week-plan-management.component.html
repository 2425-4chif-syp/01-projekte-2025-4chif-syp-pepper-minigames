@if (!isLoading) {
  <div cdkDropListGroup class="container">
    <div class="week-plan">
      <h2>Wochenplan erstellen</h2>
      <div class="week-reset">
        <button mat-raised-button color="primary" (click)="resetDate()">Diese Woche</button>
        <button mat-raised-button color="accent" style="margin-left: 5px;" (click)="exportAsWord()">
          Als Word herunterladen
        </button>
      </div>
      <div class="creation-container">
        <div class="header">
          <div class="header-top">
            <button mat-icon-button color="primary" (click)="changeDate(-7)">
              <mat-icon>chevron_left</mat-icon>
            </button>
            <input type="date" (change)="dateChange()" [(ngModel)]="selectedDate">
            <button mat-icon-button color="primary" (click)="changeDate(7)">
              <mat-icon>chevron_right</mat-icon>
            </button>
          </div>
          <div class="header-bottom">
            <div>Tagessuppe</div>
            <div>Men端 1</div>
            <div>Men端 2</div>
            <div>Nachspeise</div>
            <div>Abend 1</div>
            <div>Abend 2</div>
          </div>
        </div>
        @for (dayPlan of currentWeekPlan!.dayPlans; track dayPlan; let i = $index) {
          <div class="day-label">{{WEEK_DAYS[i]}} - {{dateCleaned(i)}}</div>
          <!-- Suppen-Zone -->
          <div class="food-card soup-card" cdkDropList [cdkDropListEnterPredicate]="soupPredicate"
            (cdkDragEntered)="onDragEntered($event)" (cdkDragExited)="onDragExited($event)"
            (cdkDropListDropped)="onSoupDrop($event, dayPlan)" [ngClass]="{'not-allowed': !isDropAllowed}">
            @if (dayPlan.daySoup) {
              <div cdkDrag class="food-item">
                <p>{{ dayPlan.daySoup }}</p>
              </div>
            }
          </div>
          <!-- Men端 1 -->
          <div class="food-card menu-card" cdkDropList [cdkDropListEnterPredicate]="mainPredicate"
            (cdkDragEntered)="onDragEntered($event)" (cdkDragExited)="onDragExited($event)"
            (cdkDropListDropped)="onMainDrop($event, dayPlan, 'menuOne')" [ngClass]="{'not-allowed': !isDropAllowed}">
            @if (dayPlan.menuOne) {
              <div cdkDrag class="food-item">
                <p>{{ dayPlan.menuOne }}</p>
              </div>
            }
          </div>
          <!-- Men端 2 -->
          <div class="food-card menu-card" cdkDropList [cdkDropListEnterPredicate]="mainPredicate"
            (cdkDragEntered)="onDragEntered($event)" (cdkDragExited)="onDragExited($event)"
            (cdkDropListDropped)="onMainDrop($event, dayPlan, 'menuTwo')" [ngClass]="{'not-allowed': !isDropAllowed}">
            @if (dayPlan.menuTwo) {
              <div cdkDrag class="food-item">
                <p>{{ dayPlan.menuTwo }}</p>
              </div>
            }
          </div>
          <!-- Dessert -->
          <div class="food-card dessert-card" cdkDropList [cdkDropListEnterPredicate]="dessertPredicate"
            (cdkDragEntered)="onDragEntered($event)" (cdkDragExited)="onDragExited($event)"
            (cdkDropListDropped)="onDessertDrop($event, dayPlan)" [ngClass]="{'not-allowed': !isDropAllowed}">
            @if (dayPlan.dessert) {
              <div cdkDrag class="food-item">
                <p>{{ dayPlan.dessert }}</p>
              </div>
            }
          </div>
          <!-- Abendessen 1 -->
          <div class="food-card evening-card" cdkDropList [cdkDropListEnterPredicate]="mainPredicate"
            (cdkDragEntered)="onDragEntered($event)" (cdkDragExited)="onDragExited($event)"
            (cdkDropListDropped)="onMainDrop($event, dayPlan, 'eveningOne')" [ngClass]="{'not-allowed': !isDropAllowed}">
            @if (dayPlan.eveningOne) {
              <div cdkDrag class="food-item">
                <p>{{ dayPlan.eveningOne }}</p>
              </div>
            }
          </div>
          <!-- Abendessen 2 -->
          <div class="food-card evening-card" cdkDropList [cdkDropListEnterPredicate]="mainPredicate"
            (cdkDragEntered)="onDragEntered($event)" (cdkDragExited)="onDragExited($event)"
            (cdkDropListDropped)="onMainDrop($event, dayPlan, 'eveningTwo')" [ngClass]="{'not-allowed': !isDropAllowed}">
            @if (dayPlan.eveningTwo) {
              <div cdkDrag class="food-item">
                <p>{{ dayPlan.eveningTwo }}</p>
              </div>
            }
          </div>
        }
      </div>
    </div>
    <div class="food-list">
      <h2>Essen</h2>
      <form>
        <label for="nameFilter">Suche nach Namen:</label>
        <input id="nameFilter" [formControl]="nameFilter" type="text">
      </form>
      <div class="food-container" cdkDropList (cdkDropListDropped)="dropFoodInFoods($event)">
        @if (!searchLoading) {
          @for (food of filteredFood; track food) {
            <div cdkDrag [cdkDragData]="food" class="food-card">
              <p>{{ food.Name }}</p>
            </div>
          }
        } @else {
          <div class="list-loading">
            <mat-spinner></mat-spinner>
          </div>
        }
      </div>
    </div>
  </div>
} @else {
  <div class="loading">
    <mat-spinner></mat-spinner>
    <p>Wochenplan wird geladen</p>
  </div>
}
