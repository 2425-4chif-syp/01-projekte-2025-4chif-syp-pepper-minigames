= Pepper Mealplan Backend
:toc:
:toclevels: 3
:sectnums:
:icons: font
:source-highlighter: highlightjs
:doctype: book
:encoding: utf-8

== 1. Einleitung

Das *Pepper Mealplan Backend* ist ein Express.js-basiertes REST-Backend, das als Teil des Pepper-Menü-Systems dient.
Es verwaltet Menüpläne, Speisen, Allergene und Bestellungen für mehrere Wochen im Voraus.
Das System wird in einem Docker-Container betrieben und nutzt eine MySQL-Datenbank als persistente Datenspeicherung.

Die Anwendung bietet eine vollständige REST-API, die über Swagger dokumentiert und testbar ist.

== 2. Architekturübersicht

[plantuml, architecture, png]
----
@startuml
package "Pepper Mealplan System" {
  [Frontend (Pepper App / Web)] --> [Backend (Express API)]
  [Backend (Express API)] --> [MySQL Datenbank]
}
@enduml
----

=== 2.1 Komponenten

|===
| Komponente | Beschreibung

| **Express.js Server**
| REST-API zur Verwaltung von Menüplänen, Speisen, Allergenen, Personen und Bestellungen.

| **MySQL (Docker Container)**
| Persistente Speicherung aller Daten in den Tabellen `Foods`, `Menu`, `Allergens`, `People`, etc.

| **Swagger UI**
| Interaktive API-Dokumentation unter `http://localhost:3000/api/docs`

| **Logger**
| Eigene Logging-Implementierung für Serverstatus und Debug-Informationen.
|===

== 3. Setup und Installation

=== 3.1 Voraussetzungen

* Node.js 18+
* npm
* Docker & Docker Compose

=== 3.2 Projekt starten

[source,bash]
----
# Repository klonen
git clone https://github.com/2425-4chif-syp/01-projekte-2025-4chif-syp-pepper-minigames.git
cd pep-mealplan/backend

# Abhängigkeiten installieren
npm install

# Docker starten
docker-compose up -d

# Server starten
npm start
----

Nach erfolgreichem Start ist das Backend unter folgendem Link erreichbar:
→ http://localhost:3000
→ Swagger UI: http://localhost:3000/api/docs

== 4. Datenbankstruktur

=== 4.1 Übersicht

[plantuml, db-schema, png]
----
@startuml
entity "Foods" {
  *id : INT
  *Name : TEXT
  *PictureID : INT
  *Type : TEXT
}

entity "Allergens" {
  *Shortname : VARCHAR(1)
  *Fullname : TEXT
}

entity "Menu" {
  *ID : INT
  *WeekNumber : INT
  *Weekday : VARCHAR(50)
  *SoupID : INT
  *M1ID : INT
  *M2ID : INT
  *LunchDessertID : INT
  *A1ID : INT
  *A2ID : INT
}

entity "FoodAllergens" {
  *id : INT
  *AllergenShortname : TEXT
  *FoodId : INT
}

entity "SpecialMeals" {
  *Date : DATE
  *SoupID : INT
  *M1ID : INT
  *M2ID : INT
  *LunchDessertID : INT
  *A1ID : INT
  *A2ID : INT
}

Foods ||--o{ Menu : "verwendet in"
Foods ||--o{ FoodAllergens : "hat"
Allergens ||--o{ FoodAllergens : "besteht aus"
@enduml
----

=== 4.2 Beispieltabellen

|===
| Tabelle | Beschreibung

| `Foods`
| Enthält alle Hauptspeisen, Desserts und Suppen.

| `Menu`
| Enthält den Menüplan pro Wochentag und Zykluswoche.

| `Allergens`
| Enthält Kürzel und Beschreibungen der Allergene.

| `FoodAllergens`
| Verknüpfungstabelle zwischen Speisen und Allergenen.

| `SpecialMeals`
| Individuelle Menüeinträge für bestimmte Daten.
|===

== 5. API-Dokumentation

Die API ist vollständig über Swagger dokumentiert und erreichbar unter:
→ `http://localhost:3000/api/docs`

=== 5.1 Menü-Routen

|===
| Methode | Endpoint | Beschreibung

| GET | `/api/menu/week/:weekNumber` | Gibt den Menüplan für die angegebene Zykluswoche zurück.
| GET | `/api/menu/weekWithSpecials/:date` | Gibt den Menüplan einer Woche inkl. Spezialmenüs zurück.
| GET | `/api/menu/today` | Liefert das Menü des aktuellen Tages.
|===

Beispielaufruf:
[source,bash]
----
curl -X GET "http://localhost:3000/api/menu/week/1" -H "accept: application/json"
----

=== 5.2 Foods-Routen

|===
| Methode | Endpoint | Beschreibung

| GET | `/api/foods` | Gibt alle Speisen zurück.
| GET | `/api/foods/:id` | Liefert Details zu einer bestimmten Speise.
|===

=== 5.3 Allergene-Routen

|===
| Methode | Endpoint | Beschreibung

| GET | `/api/allergens` | Gibt alle Allergene zurück.
|===

== 6. Beispielmenüplan (6-Wochen Zyklus)

Die Menüpläne rotieren im 6-Wochen-Zyklus und werden automatisch anhand des Startdatums berechnet (`config.START_DATE`).

Beispiel:
|===
| Woche | Zeitraum (Beispiel) | Beschreibung

| 1 | 03.11.2025 – 09.11.2025 | Standardmenü Woche 1
| 2 | 10.11.2025 – 16.11.2025 | Standardmenü Woche 2
| 3 | 17.11.2025 – 23.11.2025 | Standardmenü Woche 3
| 4 | 24.11.2025 – 30.11.2025 | Standardmenü Woche 4
| 5 | 01.12.2025 – 07.12.2025 | Zufällige Testwoche
| 6 | 08.12.2025 – 14.12.2025 | Zufällige Testwoche
|===

== 7. Docker-Setup

Beispiel aus `docker-compose.yml`:

[source,yaml]
----
version: "3.8"

services:
  pep-mySQL:
    image: mysql:9.4
    environment:
      MYSQL_ROOT_PASSWORD: app
      MYSQL_DATABASE: menu_assistent
    ports:
      - "3306:3306"
    volumes:
      - ./sql:/docker-entrypoint-initdb.d
----

Zum Starten:
[source,bash]
----
docker-compose up -d
----

== 8. Tests

Die API kann über Swagger oder mit Tools wie `curl`, `Postman` oder `VSCode REST Client` getestet werden.

Beispieltest:
[source,bash]
----
curl -X GET http://localhost:3000/api/menu/today
----

Erwartete Antwort:
[source,json]
----
{
  "Weekday": "Monday",
  "Soup": "Frittatensuppe",
  "Main1": "Spaghetti Carbonara mit Salat",
  "Dessert": "Waldbeerjoghurt"
}
----

== 9. Fazit

Das *Pepper Mealplan Backend* stellt ein modulares, erweiterbares und containerisiertes System zur Verwaltung von Menüplänen dar.
Durch den 6-Wochen-Zyklus und die dynamische Berechnung der Wochen ist das System flexibel anpassbar.
Die Nutzung von Swagger ermöglicht eine einfache Wartung und Dokumentation der API.

== 10. Quellen & Credits

* Node.js + Express Dokumentation
* MySQL Dokumentation
* Swagger UI
* HTL Leonding – Projektvorlage für Seniorenheim-Menüplan
